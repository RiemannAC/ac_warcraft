version: '3'
services: # 列出所有需要的服務
  db: # 服務的名稱
    image: postgres # 指定鏡像檔案
    volumes: # 暫存檔位置
    - ./tmp/db:/var/lib/postgresql/data
  redis:
    image: 'redis:4.0-alpine'
    command: redis-server --requirepass yourpassword # 運行後要下的指令
    volumes:
    - 'redis:/data'
  web:
    build: . # 依照根目錄的Dockerfile去build鏡像檔案
    command: bundle exec rails s -p 3000 -b '0.0.0.0'
    volumes:
    - .:/myapp
    ports: # 要開哪個port。格式為:本地端port：container中的port
    - "3000:3000"
    depends_on: # 這個鏡像依賴哪一些鏡像檔案
    - db
    - redis
  cable:
    depends_on:
    - 'redis'
    build: .
    command: puma -p 28080 cable/config.ru
    ports:
    - '28080:28080'
    volumes:
    - '.:/app'
volumes:
  redis:
  postgres:


